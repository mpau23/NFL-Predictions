NflPredictionsApp.controller("GamesCtrl",["$scope","$rootScope","$http","$q","$stateParams","Game","Team","Prediction",function(e,r,t,a,o,n,i,c){function s(){var e=new Array;return t.get("/api/game/"+o.week).then(function(r){angular.forEach(r.data,function(r,t){date=new Date(r.date),date.setHours(date.getHours()+5),e.push(new n(r._id,r.week,date.toString(),new i(r.awayTeam._id,r.awayTeam.shortName,r.awayTeam.fullName),new i(r.homeTeam._id,r.homeTeam.shortName,r.homeTeam.fullName)))})}).then(function(){angular.forEach(e,function(e,a){t.get("/api/prediction/"+e.id+"/"+r.currentUser).then(function(r){e.prediction=r.data?new c(r.data.homePrediction,r.data.awayPrediction,r.data.joker):new c(0,0,!1)})})}),e}e.games=s(),e.pushGames=function(){var e,r,a=new Array;t.get("/json/nfl-fixtures.json").then(function(o){e=o.data.Schedule,r=o.data.centerIds;var i,c,s=0;angular.forEach(e,function(e,t){angular.forEach(r,function(r,t){r.week===e.gameWeek&&(i=r),angular.forEach(i.games,function(r,t){r.home===e.homeTeam&&(c=r.id)})}),i.games[s]||(s=0),a.push(new n(c,e.gameWeek,e.gameDate+" "+e.gameTimeET,e.awayTeam,e.homeTeam)),s++}),angular.forEach(a,function(e,r){t.post("/api/game",{id:e.id,week:e.week,homeTeam:e.homeTeamId,awayTeam:e.awayTeamId,date:e.date})})})},e.submit=function(){angular.forEach(e.games,function(e,a){t.post("/api/prediction",{user:r.currentUser,game:e.id,homePrediction:e.prediction.homePrediction,awayPrediction:e.prediction.awayPrediction,joker:e.prediction.joker})})},e.jokerChange=function(r){angular.forEach(e.games,function(e,t){r!=e&&(e.prediction.joker=!1)})}}]),NflPredictionsApp.controller("LeaderboardCtrl",["$scope","$http","$q","User","Prediction","Game","Team","Results",function(e,r,t,a,o,n,i,c){function s(){var e=new Array;return r.get("/api/user").then(function(t){angular.forEach(t.data,function(r,t){e.push(new a(r.fullName,r.username))}),r.get("/api/game").then(function(t){angular.forEach(t.data,function(t,a){var o=new Date,n=new Date(t.date);n.setHours(n.getHours()+5),o>n&&r.get("/api/results/"+t._id).then(function(a){responseObj=new Array,angular.forEach(a.data,function(e,r){responseObj.push(e)});var o=new c(t._id,t.week,responseObj[0].away.score.T,responseObj[0].home.score.T);angular.forEach(e,function(e,a){r.get("/api/prediction/results/"+t._id+"/"+e.username).then(function(r){if(r.data){var t=!1,a=!1,n=!1,i=0;o.awayScore+o.homeScore==r.data.awayPrediction+r.data.homePrediction&&(t=!0),o.awayScore<o.homeScore&&r.data.awayPrediction<r.data.homePrediction&&(a=!0),o.awayScore>o.homeScore&&r.data.awayPrediction>r.data.homePrediction&&(a=!0),o.awayScore==o.homeScore&&r.data.awayPrediction==r.data.homePrediction&&(a=!0),o.awayScore==r.data.awayPrediction&&o.homeScore==r.data.homePrediction&&(n=!0),t&&(i+=5),a&&(i+=10),n&&(i+=15),r.data.joker&&(i*=2),e.addPoints(i)}})})})})}).then(function(){})}),e}e.users=s()}]),NflPredictionsApp.controller("LoginCtrl",["$scope","$http","Authentication","$location",function(e,r,t,a){e.loginUsername="",e.loginPassword="",t.clearCredentials(),e.login=function(){e.dataLoading=!0,t.login(e.loginUsername,e.loginPassword,function(r){r.error?e.error=r.error:(t.setCredentials(e.loginUsername,e.loginPassword),a.path("/leaderboard"))})},e.registerUsername="",e.registerPassword="",e.registerName="",e.registerEmail="",e.register=function(){t.register(e.registerUsername,e.registerPassword,e.registerName,e.registerEmail,function(r){r.error?e.error=r.error:(t.setCredentials(e.loginUsername,e.loginPassword),a.path("/leaderboard"))})}}]),NflPredictionsApp.controller("RootCtrl",["$scope",function(e){e.author="Miren Pau"}]),NflPredictionsApp.controller("TeamsCtrl",["$scope","$http","Team",function(e,r,t){function a(){var e,a=new Array;return r.get("/json/nfl-teams.json").then(function(r){e=r.data.NFLTeams,angular.forEach(e,function(e,r){a.push(new t(e.code,e.shortName,e.fullName))})}),a}e.teams=a()}]),NflPredictionsApp.factory("Authentication",["Base64","$http","$cookies","$rootScope","$timeout",function(e,r,t,a,o){var n={login:function(e,t,a){r.get("/api/user/"+e+"/"+t).then(function(e){e.data||(e.error="Username or password is incorrect"),a(e)})},register:function(e,t,a,o,n){r.post("/api/user",{fullName:a,email:o,username:e,password:t}).then(function(e){e.data._id||(e.error="There was a problem creating an account"),n(e)})},setCredentials:function(o,n){var i=e.encode(o+":"+n);a.currentUser=i,r.defaults.headers.common.Authorization="Basic "+i,t.put("currentUser",a.currentUser)},clearCredentials:function(){delete a.currentUser,t.remove("currentUser"),r.defaults.headers.common.Authorization="Basic "}};return n}]),NflPredictionsApp.factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(r){var t,a,o,n,i,c="",s="",d="",u=0;do t=r.charCodeAt(u++),a=r.charCodeAt(u++),s=r.charCodeAt(u++),o=t>>2,n=(3&t)<<4|a>>4,i=(15&a)<<2|s>>6,d=63&s,isNaN(a)?i=d=64:isNaN(s)&&(d=64),c=c+e.charAt(o)+e.charAt(n)+e.charAt(i)+e.charAt(d),t=a=s="",o=n=i=d="";while(u<r.length);return c},decode:function(r){var t,a,o,n,i,c="",s="",d="",u=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(r)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=e.indexOf(r.charAt(u++)),n=e.indexOf(r.charAt(u++)),i=e.indexOf(r.charAt(u++)),d=e.indexOf(r.charAt(u++)),t=o<<2|n>>4,a=(15&n)<<4|i>>2,s=(3&i)<<6|d,c+=String.fromCharCode(t),64!=i&&(c+=String.fromCharCode(a)),64!=d&&(c+=String.fromCharCode(s)),t=a=s="",o=n=i=d="";while(u<r.length);return c}}}),NflPredictionsApp.factory("Game",function(){var e=function(e,r,t,a,o,n,i,c){this.id=e,this.week=r,this.date=t,this.awayTeam=a,this.homeTeam=o,this.prediction=n,this.awayScore=i,this.homeScore=c};return e}),NflPredictionsApp.factory("Prediction",function(){var e=function(e,r,t){this.homePrediction=e,this.awayPrediction=r,this.joker=t};return e}),NflPredictionsApp.factory("Results",function(){var e=function(e,r,t,a){this.id=e,this.week=r,this.users=new Array,this.awayScore=t,this.homeScore=a};return e.prototype.addUser=function(e){this.users.push(e)},e}),NflPredictionsApp.factory("Team",function(){var e=function(e,r,t){this.code=e,this.shortName=r,this.fullName=t};return e}),NflPredictionsApp.factory("User",function(){var e=function(e,r){this.fullName=e,this.username=r,this.predictions=new Array,this.points=0};return e.prototype.addPrediction=function(e){this.predictions.push(e)},e.prototype.addPoints=function(e){this.points+=e},e}),NflPredictionsApp.run(["$rootScope","$location","$cookies","$http",function(e,r,t,a){e.currentUser=t.get("currentUser"),e.currentUser&&(a.defaults.headers.common.Authorization="Basic "+e.currentUser),e.$on("$locationChangeStart",function(a,o,n){e.currentUser;"/login"==r.path()||t.get("currentUser")||r.path("/login")})}]),NflPredictionsApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,r,t){t.html5Mode(!0),r.otherwise("/"),e.state("home",{name:"home",url:"/",templateUrl:"views/home.html",controller:"RootCtrl"}).state("teams",{name:"home.teams",url:"/teams",templateUrl:"views/teams.html",controller:"TeamsCtrl"}).state("games",{name:"home.games",url:"/games/week/:week",templateUrl:"views/games.html",controller:"GamesCtrl"}).state("leaderboard",{name:"home.leaderboard",url:"/leaderboard",templateUrl:"views/leaderboard.html",controller:"LeaderboardCtrl"}).state("login",{name:"home.login",url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"})}]);